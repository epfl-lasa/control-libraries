# Control Libraries Protocol

This module serves to define the protocol for sending and receiving
messages containing control libraries data across any network. 

The basis of the module is the Google Protocol Buffer, [protobuf](https://developers.google.com/protocol-buffers).

## Structure

The [protobuf](./protobuf) directory contains the raw .proto message definitions
as well as a set of bindings by language that are generated by
the protobuf compiler (protoc). These bindings are not intended
to be directly user-facing.

The [clproto_cpp](./clproto_cpp) directory contains the actual user-facing library,
with the translation between control libraries data and proto
message formats hidden behind a neat header file. The API
allows compatible objects to be easily encoded into a serialized
binary string for transmitting across. Equivalently, well-formatted
string messages can be decoded back into the equivalent objects.

## Installation

In order to generate and use those bindings, you need google protobuf to be installed on your computer (cf. https://github.com/protocolbuffers/protobuf/blob/master/src/README.md).
If you are using Docker, `protoc` is already built in the `development-dependencies` image.
You can copy the library using docker `COPY` functionality:

```Dockerfile
COPY --from=ghcr.io/epfl-lasa/control-libraries/development-dependencies:latest /usr/local/include/google /usr/local/include/google
COPY --from=ghcr.io/epfl-lasa/control-libraries/development-dependencies:latest /usr/local/lib/libproto* /usr/local/lib
COPY --from=ghcr.io/epfl-lasa/control-libraries/development-dependencies:latest /usr/local/bin/protoc /usr/local/bin
RUN ldconfig
```

Once `protoc` is installed, you can generate the bindings in the [protobuf](./protobuf) directory and the cmake target `clproto` in [clproto_cpp](./clproto_cpp) by running:

```console
(sudo) ./install.sh
```